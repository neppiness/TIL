 **Chapter 2. Basic Sockets**

* 자바로 소켓을 구현해보자. 

## 2.1 Socket Addresses
* IP 주소는 네트워크와 호스트 간 연결에 대해 할당된다.
* 네트워크 인터페이스 클래스는 호스트의 모든 인터페이스들에 대한 정보를 제공한다.
* TTL: time to live를 설정해서 패킷이 인터넷을 영원히 떠돌지 않게 시간 제한을 설정할 수 있음.
* 자바에서 제공하는 메소드들에 대한 서술이 쭉 이어짐.

## 2.2 TCP Sockets
* 자바의 TCP 클래스는 Socket과 ServerSocket, 이렇게 두 가지가 있다. 소켓 인스턴스는 TCP 연결의 한 끝단을 나타낸다.
* 통신 전에 TCP 연결은 셋업 페이즈를 수행해야 한다. 이는 클라이언트가 서버에 요청하며 시작된다.
* ServerSocket 인스턴스는 TCP 연결 요청을 듣고 새로운 Socket 통신을 위해 인스턴스를 만든다.
  - 그러므로, 서버들은 ServerSocket과 Socket 인스턴스를 모두 다룬다.
  - 반면 클라이언트들은 Socket 인스턴스만 다룬다.

### 2.2.1 TCP Client
* 일반적 TCP 클라이언트는 연결을 위한 세 단계를 거친다.
  1. 소켓 인스턴스 생성: 명시된 서버의 주소와 포트 번호를 통해 TCP 연결을 수립
  2. 소켓의 I/O 스트림 활용: 연결된 Socket 인스턴스는 InputStream과 OupputStream을 포함한다. 이는 자바 I/O 스트림과 유사하다.
  3. 소켓의 close() 메소드를 통해 연결을 닫는다.
* 위 같은 개념을 통해 에코 서버에 대한 클라이언트를 만듦.

```java
import java.net.Socket;
import java.net.SocketException;
import java.io.IOException;
import java.io.InputStream;
import java.io.OutputStream;

public class TCPEchoClient {

    public static void main(String[] args) throws IOException {

        if ((args.length < 2) || (args.length > 3)) // Test for correct # of args
            throw new IllegalArgumentException("Parameter(s): <Server> <Word> [<Port>]");

        String server = args[0]; // Server name or IP address
        // Convert argument String to bytes using the default character encoding
        byte[] data = args[1] getBytes();

        int servPort = (args.length == 3) ? Integer.parseInt(args[2]) : 7;

        // Create socket that is connected to server on specified port
        Socket socket = new Socket(server, servPort);
        System.out.println("Connected to server...sending echo string");

        InputStream in = socket.getInputStream();
        OutputStream out = socket.getOutputStream();

        out.write(data); // Send the encoded string to the server

        // Receive the same string back from the server
        int totalBytesRcvd = 0; // Total bytes received so far
        int bytesRcvd; // Bytes received in last read
        while (totalBytesRcvd < data.length) {
            if ((bytesRcvd = in.read(data, totalBytesRcvd,
                    data.length - totalBytesRcvd)) == -1)
                throw new SocketException("Connection closed prematurely");
            totalBytesRcvd += bytesRcvd;
        } // data array is full

        System.out.println("Received: " + new String(data));

        socket.close(); // Close the socket and its streams
    }
}
```
* 기본적으로 소켓은 TCP 연결 위에 구현된다. 그러나, 자바에선 이를 변경 가능하다.

### 2.2.2 TCP Server
* *TO BE CONTINUED*
