**토비의 스프링 3.1**

# 5장: 서비스 추상화
## 5.1 사용자 레벨 관리 기능 추가
### 5.1.1 필드 추가
* Level 이넘
    - 아래와 같이 등급을 상수로 설정한다고 보자.

```java
class User {
    private static final int BASIC = 1;
    private static final int SILVER = 2;
    private static final int GOLD = 3;

    int level;

    public void setLevel(int level) {
        this.level = level;
    }
}
```

* setLevel에 의해서 잘못된 값이 활용될 여지가 있기에 enum을 사용한다.
    - 사실 enum을 써도 등급을 잘못 넣으면 답이 없음.

```java
public enum Level {

    BASIC(1), SILVER(2), GOLD(3);

    private final int value;

    Level(int value) {
        this.value = value;
    }

    public int intValue() {
        return value;
    }

    public static Level valueOf(int value) {
        switch(value) {
            case 1: return BASIC;
            case 2: return SILVER;
            case 3: return GOLD;
            default: throw new AssertionError("Unknown value: " + value);
        }
    }

}
```

* 사실 이와 같은 AssertionError를 사용하는 것으로 만족된다면, 숫자를 써서 활용하면서 값이 벗어났을 때 커스텀 에러를 써도 똑같음.
    - 대체 이넘은 뭐가 좋은 걸까?

#### UserDaoTest 테스트 수정
* User에 모든 인자로 객체를 만드는 생성자를 추가
* 이후 테스트 로직을 구성
    - checkSameUser() 라는 메소드를 통해서 두 유저가 서로 같은 유전지 확인하는 테스트 코드 작성

#### UserDaoJdbc 수정

```java
public class UserDaoJdbc implements UserDao {

    private RowMapper<User> userMapper =
        new RowMapper<User>() {
            public User mapRow(ResultSet rs, int rowNum) throws SQLException {
                User user = new User();
                user.setId(rs.getString("id"));
                user.setName(rs.getString("name"));
                user.setPassword(rs.getString("password"));
                user.setLevel(Level.valueOf(rs.getInt("level")));
                user.setLogin(rs.getInt("loign"));
                user.setRecommend(rs.getInt("recommend"));
                return user;
            }
        }

}
```

* Enum은 DB에 저장될 수 없다.
    - 따라서, DB에 저장 가능한 정수형 값으로 변환해줘야 한다.
* rs를 가져오는 과정은 오타가 있는 경우에 잡아내기 어렵다고 함.
    - 테스트가 있다면 이런 부분의 문제를 바로 확인하고 처리할 수 있다.

### 5.1.2 사용자 수정 기능 추가
* PDF page 326
